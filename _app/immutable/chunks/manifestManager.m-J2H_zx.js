var tt=Object.defineProperty;var st=(a,t,e)=>t in a?tt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var d=(a,t,e)=>(st(a,typeof t!="symbol"?t+"":t,e),e);import{s as nt,y as Fe,T as ye,U as Re,a as _e,d as ke,f as L,V as Ie,i as it,g as at,u as C,n as Me,w as rt,E as Te,W as ot,F as Ce,L as S,a0 as l}from"./scheduler.3290unkr.js";import{t as Se,g as lt,R as _,h as Ue,V as z}from"./bundle-mjs.N7ra371j.js";import{S as ut,i as dt}from"./index.ogpWc0fe.js";import{d as v,w as f,r as me,a as H}from"./index.Hduz1s-6.js";import{i as W,u as We,d as ve,_ as he,f as q,v as ze,g as ct,N as A,r as mt,b as gt,c as vt,j as se,k as ge,l as Z,m as ne,n as ie,M as ae,o as ht,p as ft,q as At,H as Nt,t as bt,w as pt,P as kt,x as Pt,y as Ke,z as V,A as Ft,B as Et,C as Vt,E as Ot,F as xe}from"./entityCache.MMyPzm4R.js";import{N as I,P as wt,e as yt,a as Ge,L as Rt}from"./caching.y0CrmXZh.js";import{S as _t,g as It}from"./schemaParsing.7qF-2jSm.js";import{v as fe,e as re}from"./entityProvider.gYwLMq-s.js";import{r as Y,a as j}from"./valuesKinds.teR6jadp.js";function Mt(a){let t,e,n,s,i,r=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},a[7],{class:n=Se("shrink-0",a[6][a[0]],a[8].class)},{role:a[1]},{"aria-label":a[5]},{viewBox:"0 0 18 20"}],o={};for(let u=0;u<r.length;u+=1)o=Fe(o,r[u]);return{c(){t=ye("svg"),e=ye("path"),this.h()},l(u){t=Re(u,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var c=_e(t);e=Re(c,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_e(e).forEach(ke),c.forEach(ke),this.h()},h(){L(e,"stroke","currentColor"),L(e,"stroke-linecap",a[2]),L(e,"stroke-linejoin",a[3]),L(e,"stroke-width",a[4]),L(e,"d","M3 8V5.828a2 2 0 0 1 .586-1.414l2.828-2.828A2 2 0 0 1 7.828 1h8.239A.969.969 0 0 1 17 2v16a.969.969 0 0 1-.933 1H3.933A.97.97 0 0 1 3 18v-2M8 1v4a1 1 0 0 1-1 1H3m-2 6h10M9.061 9.232 11.828 12l-2.767 2.768"),Ie(t,o)},m(u,c){it(u,t,c),at(t,e),s||(i=[C(t,"click",a[9]),C(t,"keydown",a[10]),C(t,"keyup",a[11]),C(t,"focus",a[12]),C(t,"blur",a[13]),C(t,"mouseenter",a[14]),C(t,"mouseleave",a[15]),C(t,"mouseover",a[16]),C(t,"mouseout",a[17])],s=!0)},p(u,[c]){c&4&&L(e,"stroke-linecap",u[2]),c&8&&L(e,"stroke-linejoin",u[3]),c&16&&L(e,"stroke-width",u[4]),Ie(t,o=lt(r,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"none"},c&128&&u[7],c&257&&n!==(n=Se("shrink-0",u[6][u[0]],u[8].class))&&{class:n},c&2&&{role:u[1]},c&32&&{"aria-label":u[5]},{viewBox:"0 0 18 20"}]))},i:Me,o:Me,d(u){u&&ke(t),s=!1,rt(i)}}}function Tt(a,t,e){const n=["size","role","strokeLinecap","strokeLinejoin","strokeWidth","ariaLabel"];let s=Te(t,n);const i=ot("iconCtx")??{},r={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{size:o=i.size||"md"}=t,{role:u=i.role||"img"}=t,{strokeLinecap:c=i.strokeLinecap||"round"}=t,{strokeLinejoin:m=i.strokeLinejoin||"round"}=t,{strokeWidth:h=i.strokeWidth||"2"}=t,{ariaLabel:b="file import outline"}=t;function N(k){S.call(this,a,k)}function p(k){S.call(this,a,k)}function P(k){S.call(this,a,k)}function E(k){S.call(this,a,k)}function O(k){S.call(this,a,k)}function Xe(k){S.call(this,a,k)}function Qe(k){S.call(this,a,k)}function $e(k){S.call(this,a,k)}function et(k){S.call(this,a,k)}return a.$$set=k=>{e(8,t=Fe(Fe({},t),Ce(k))),e(7,s=Te(t,n)),"size"in k&&e(0,o=k.size),"role"in k&&e(1,u=k.role),"strokeLinecap"in k&&e(2,c=k.strokeLinecap),"strokeLinejoin"in k&&e(3,m=k.strokeLinejoin),"strokeWidth"in k&&e(4,h=k.strokeWidth),"ariaLabel"in k&&e(5,b=k.ariaLabel)},t=Ce(t),[o,u,c,m,h,b,r,s,t,N,p,P,E,O,Xe,Qe,$e,et]}class Is extends ut{constructor(t){super(),dt(this,t,Tt,Mt,nt,{size:0,role:1,strokeLinecap:2,strokeLinejoin:3,strokeWidth:4,ariaLabel:5})}}function Ct(a){const t=a.key.value,e=a.value.fields[4],n=e.fields[1],i=e.fields[5].fields[0].entries;if(n.variant_id!=="0")throw new Error("Unhandled Schema: Schema is not of expected type SchemaV1");const r=new _t(n.fields[0]),o=i.reduce((c,m)=>{const h=St(m,r);return c[h.name]=h,c},{});return[{name:t,functions:o},r]}function St(a,t){const e=a.key.value,[n,s,i]=a.value.fields;if(s.variant_id!=="0")throw new Error("Unhandled case TypeRef::Generic");const r=s.fields[0];if(r.variant_id!=="1")throw new Error("Unhandled case LocalTypeId::WellKnown");const o=parseInt(r.fields[0].value),u=t.extractFunctionArguments(o);if(i.variant_id!=="0")throw new Error("Unhandled case TypeRef::Generic");return{name:e,isMethod:n.variant_id==="1",args:u}}const He=_.Utils.knownAddresses(I).then(a=>a.packageAddresses.packagePackage);async function Kt(a,t){const e=await xt(a,t);if(!e)return;const i=(await Lt(e)).fields[0].entries.map(u=>Ct(u)),r={},o={};for(const[u,c]of i)r[u.name]=u,o["dummy_hash_"+fe()]=c;return{blueprints:r,schemas:o}}async function xt(a,t){const s={kind:"String",value:`
    ALLOCATE_GLOBAL_ADDRESS
      Address("${await He}")
      "Package"
      AddressReservation("${t}")
      NamedAddress("${t}")
    ;
    `+a};try{return(await _.Instructions.convert(s,I,"Parsed")).value[1]}catch(i){console.log(i);return}}async function Lt(a){switch(a.kind){case"CallFunction":const n=await He;if(a.packageAddress.kind!="Static"||a.packageAddress.value!=n||a.blueprintName!="Package"||a.functionName!="publish_wasm_advanced"&&a.functionName!="publish_native")throw new Error("Passed instruction is not a publish package instruction");break;default:throw new Error("Passed instruction is not a CallFunction instruction")}const t=await _.Instructions.compile({kind:"Parsed",value:[a]},I),e=await _.ManifestSbor.decodeToString(t,I,Ue.ProgrammaticJson).then(JSON.parse);return a.functionName==="publish_wasm_advanced",e.elements[0].fields[3].fields[1]}class M{constructor(){d(this,"unsubscriber")}subscribe(t,e,n){const s=ve(this.constructFilterFunction(n));let i;this.unsubscriber=v([t,s],W).subscribe(([r,o])=>{const u=(o==null?void 0:o(r))??r;he.isEqual(u,i)||(i=u,e.set(u))})}unsubscribe(){var t;(t=this.unsubscriber)==null||t.call(this),this.unsubscriber=void 0}}class Le extends M{constructFilterFunction(t){return f(void 0)}}class Dt extends M{constructFilterFunction(t){const e=l(t.fixedArgs),n=e[0].value.currentValueNode(),s=e[1].value.currentValueNode(),i=e[2].value.currentValueNode(),r=e[3].value.currentValueNode();return v([n.value,s.value,i.value,r.value],([o,u,c,m])=>b=>{const N=[...b];return c&&N.push({kind:"AddressReservation",name:c,packageAddress:o,blueprintName:u,namedAddressName:m,isConsumed:!1}),m&&N.push({kind:"NamedAddress",name:m,packageAddress:o,blueprintName:u,addressReservationName:c,isConsumed:!1}),N})}}class x extends M{constructor(t){super(),this.config=t}constructFilterFunction(t){let e;const n=l(t.fixedArgs);if(this.config.resourceAddressArgIndex!=null){const i=n[this.config.resourceAddressArgIndex].value.currentValueNode();e=v(i.validStaticOrNamedAddress,async r=>{const o=await r;return(o==null?void 0:o.kind)==="static"?{entityVariant:o.entityVariant}:void 0})}else e=f(Promise.resolve({entityVariant:void 0}));const s=n[this.config.ownableNameArgIndex].value.currentValueNode();return v([e,s.value],([i,r])=>{if(!r.trim())return;const o=i.then(c=>(c==null?void 0:c.entityVariant)==="FungibleResource"?"Fungible":(c==null?void 0:c.entityVariant)==="NonFungibleResource"?"NonFungible":void 0);return c=>[...c,{kind:s.valueKind.kind,name:r,resourceVariant:o,isConsumed:!1}]})}static create(t){return class extends x{constructor(){super(t)}}}}class oe extends M{constructor(t){super(),this.config=t}constructFilterFunction(t){const e=l(t.fixedArgs),n=e[this.config.bucketNameArgIndex].value.currentValueNode(),s=e[this.config.proofNameArgIndex].value.currentValueNode();return v([n.value,s.value],([i,r])=>u=>{const c=u.find(m=>m.kind==="Bucket"&&m.name===i);if((c==null?void 0:c.kind)==="Bucket"&&r){const m={kind:"Proof",name:r,resourceVariant:c.resourceVariant,isConsumed:!1};return[...u,m]}else return u})}static create(t){return class extends oe{constructor(){super(t)}}}}class Bt extends M{constructFilterFunction(t){const e=l(t.fixedArgs),n=e[0].value.currentValueNode(),s=e[1].value.currentValueNode();return v([n.value,s.value],([i,r])=>u=>{const c=u.find(m=>m.kind==="Proof"&&m.name===i);if(c&&r){const m={...c,name:r};return[...u,m]}else return u})}}class Ze extends M{constructFilterFunction(t){return f(e=>e.map(n=>n.kind==="Proof"?{...n,isConsumed:!0}:n))}}class Ve extends M{constructFilterFunction(t){const n=l(t.fixedArgs)[0].value.currentValueNode();return v(n.value,s=>r=>r.map(o=>o.kind===n.valueKind.kind&&o.name===s?{...o,isConsumed:!0}:o))}}class Q extends M{constructFilterFunction(t){const e=Q.derivePublishConstellation(t);return v(e,(n,s)=>{if(!n){s(c=>c);return}const r=n.packageDefinitionNode.validationResult;let o=n.packageAddressNode;const u=o.validationResult;return v([r,u],W).subscribe(([c,m])=>{const h=l(o.value.values)[0],b=h==null?void 0:h.currentValueNode();if(!b){s(E=>E);return}const N=l(b.value),p=Q.getPackageDefinition(c,m,N,t);s(E=>E.map(O=>O.kind==="AddressReservation"&&O.name===N?{...O,packageDefinition:p}:O))})},void 0)}static async getPackageDefinition(t,e,n,s){if(!((await t).valid&&(await e).valid)&&n)return;const i=await s.toManifestString();return await Kt(i,n)}static derivePublishConstellation(t){return We(v(t.args,async e=>{const n=(await _.Utils.knownAddresses(I)).packageAddresses.packagePackage,s=l(t.command),i=await e;if(s==="PUBLISH_PACKAGE_ADVANCED"&&i.length===5)return{packageDefinitionNode:i[1].value.currentValueNode(),packageAddressNode:i[4].value.currentValueNode()};if(s==="CALL_FUNCTION"){const r=l(i[0].value.currentValueNode().value),o=l(i[1].value.currentValueNode().value),u=l(i[2].value.currentValueNode().value);if(r===n&&o==="Package"&&u==="publish_wasm_advanced"&&i.length===8)return{packageDefinitionNode:i[4].value.currentValueNode(),packageAddressNode:i[7].value.currentValueNode()}}}),void 0)}}class T extends M{constructFilterFunction(t){return v(t.argConsumedInputs,e=>e.length===0?void 0:s=>s.map(i=>e.find(o=>o.kind===i.kind&&o.name===i.name)!=null?{...i,isConsumed:!0}:i))}}class Ae extends M{constructor(e){super();d(this,"filters");this.filters=e.map(n=>new n)}constructFilterFunction(e){const n=this.filters.map(s=>s.constructFilterFunction(e));return v(n,s=>r=>{let o=r;for(const u of q(s))o=u(o);return o})}static create(...e){return class extends Ae{constructor(){super(e)}}}}class Ut{constructor(){d(this,"internalCache",new wt(yt))}async getScryptoPackage(t){if((await ze(t,["Package"])).valid)return this.internalCache.get(t,()=>ct.findPackage(t))}}const D=new Ut;class le{constructor(t){d(this,"argObserverUnsubscriber");d(this,"advisorUnsubscriber");this.observedArgsIndices=t}subscribe(t){this.argObserverUnsubscriber=t.args.subscribe(async e=>{var s;(s=this.advisorUnsubscriber)==null||s.call(this);const n=await e;if(n.length>Math.max(...this.observedArgsIndices)){const i=this.observedArgsIndices.map(r=>n[r].value.currentValueNode());this.advisorUnsubscriber=this.adviseInstruction(t,i)}})}unsubscribe(){var t,e;(t=this.advisorUnsubscriber)==null||t.call(this),(e=this.argObserverUnsubscriber)==null||e.call(this)}}class Wt extends le{constructor(){super([0,1])}adviseInstruction(t,e){const[n,s]=e;return n.value.subscribe(async i=>{const r=await D.getScryptoPackage(i);if(!r){s.clearOptions();return}const o=Object.keys(r.blueprints);s.setOptions(o)})}}class zt extends le{constructor(){super([0,1])}adviseInstruction(t,e){const[n,s]=e;return n.validStaticOrNamedAddress.subscribe(async i=>{const r=await i;if(!r){s.clearOptions();return}const[o,u]=await Ye(r),c=o==null?void 0:o.blueprints[u??""],m=c?Object.values(c.functions).filter(h=>h.isMethod).map(h=>h.name):void 0;m!=null?s.setOptions(m):s.clearOptions()})}}class Gt extends le{constructor(){super([0,1,2]);d(this,"previousPackageAddress");d(this,"selectedPackage")}adviseInstruction(e,n){const[s,i,r]=n;return v([s.validStaticOrNamedAddress,i.value,e.inputs],W).subscribe(async([o,u,c])=>{var p;const m=await o;if(!m){m!==this.previousPackageAddress&&(r.clearOptions(),i.clearOptions(),this.previousPackageAddress=m);return}if(m.kind==="named"){const P=c.find(E=>E.kind==="AddressReservation"&&E.namedAddressName===m.addressName);this.selectedPackage=(P==null?void 0:P.kind)==="AddressReservation"?await P.packageDefinition:void 0}else m.address!==this.previousPackageAddress&&(this.selectedPackage=await D.getScryptoPackage(m.address),this.previousPackageAddress=m.address);const h=this.selectedPackage?Object.keys(this.selectedPackage.blueprints):void 0,b=(p=this.selectedPackage)==null?void 0:p.blueprints[u],N=b?Object.values(b.functions).filter(P=>!P.isMethod).map(P=>P.name):void 0;h!=null?i.setOptions(h):i.clearOptions(),N!=null?r.setOptions(N):r.clearOptions()})}}class Ne extends le{constructor(t){super([t.addressArgIndex,t.methodNameArgIndex])}adviseInstruction(t,e){const[n,s]=e;return n.validStaticOrNamedAddress.subscribe(async i=>{var h;const r=await i;if(!r){s.clearOptions();return}const[o,u]=await Ye(r),c=(h=o==null?void 0:o.blueprints)==null?void 0:h[u??""],m=c?Object.values(c.functions).filter(b=>b.isMethod).map(b=>b.name):void 0;m!=null?s.setOptions(m):s.clearOptions()})}static create(t){return class extends Ne{constructor(){super(t)}}}}class Ht extends le{constructor(){super([0,1,2])}adviseInstruction(t,e){const[n,s,i]=e;return v([n.value,s.value.discriminatorValue],W).subscribe(async([r,o])=>{var h,b,N,p,P,E;const u=(b=(h=s.valueKind.variants)==null?void 0:h.get(o??-1))==null?void 0:b.name;if(!u){i.clearOptions();return}const c=await re.getEntity(r);if(((N=c==null?void 0:c.details)==null?void 0:N.type)!=="Component"&&((p=c==null?void 0:c.details)==null?void 0:p.type)!=="FungibleResource"&&((P=c==null?void 0:c.details)==null?void 0:P.type)!=="NonFungibleResource"){i.clearOptions();return}const m=(E=c.details.roleAssignments)==null?void 0:E.entries.map(O=>O.role_key).filter(O=>O.module===u).map(O=>O.name);m?i.setOptions(m):i.clearOptions()})}}async function Ye(a){var n;let t,e;if(a.kind==="named"){const s=a.packageAddress;t=s?await D.getScryptoPackage(s):void 0,e=a.blueprintName}else{const s=await re.getEntity(a.address),i=(n=s==null?void 0:s.details)==null?void 0:n.type;if(i==="Component"||i==="FungibleResource"||i==="NonFungibleResource"){const r=s==null?void 0:s.details.packageAddress;t=r?await D.getScryptoPackage(r):void 0,e=s==null?void 0:s.details.blueprintName}}return[t,e]}class be{}class F extends be{constructor(t){super(),this.functionReference=t}getVariableArgDefinitions(t){return f(this.getVariableArgDefinitionsAsync())}async getVariableArgDefinitionsAsync(){const e=(await _.Utils.knownAddresses(I)).packageAddresses[this.functionReference.wellKnownPackageName];return(await D.getScryptoPackage(e)).blueprints[this.functionReference.blueprintName].functions[this.functionReference.functionName].args}static create(t){return class extends F{constructor(){super(t)}}}}class Zt extends be{getVariableArgDefinitions(t){const e=l(t.fixedArgs),n=e[0].value.currentValueNode(),s=e[1].value.currentValueNode(),i=e[2].value.currentValueNode();return v([n.validStaticOrNamedAddress,s.value,i.value,t.inputs],async([r,o,u,c])=>{var p;const m=await r;if(!m)return;let h;if(m.kind==="named"){const P=c.find(E=>E.kind==="AddressReservation"&&E.namedAddressName===m.addressName);h=(P==null?void 0:P.kind)==="AddressReservation"?await P.packageDefinition:void 0}else m.address&&(h=await D.getScryptoPackage(m.address));if(!h)return;const b=h.blueprints[o],N=(p=b==null?void 0:b.functions)==null?void 0:p[u];return(N==null?void 0:N.args)??[]})}}class Yt extends be{getVariableArgDefinitions(t){const e=l(t.fixedArgs),n=e[0].value.currentValueNode(),s=e[1].value.currentValueNode();return v([n.validStaticOrNamedAddress,s.value],async([i,r])=>{var b,N;const o=await i;if(!o)return;let u,c;if(o.kind==="named")u=o.packageAddress?await D.getScryptoPackage(o.packageAddress):void 0,c=o.blueprintName;else{const p=await re.getEntity(o.address),P=(b=p==null?void 0:p.details)==null?void 0:b.type;if(P==="Component"||P==="FungibleResource"||P==="NonFungibleResource"){const E=p==null?void 0:p.details.packageAddress;u=E?await D.getScryptoPackage(E):void 0,c=p==null?void 0:p.details.blueprintName}}if(!u)return;const m=u.blueprints[c??""],h=(N=m==null?void 0:m.functions)==null?void 0:N[r];return(h==null?void 0:h.args)??[]})}}class X extends be{constructor(t){super(),this.args=t}getVariableArgDefinitions(t){return me(f(Promise.resolve(this.args)))}static create(t){return class extends X{constructor(){super(t)}}}}class jt{constructor(){d(this,"argumentDefinitionsByCommand",new Map)}registerInstruction(t,e){this.argumentDefinitionsByCommand.set(t,{args:e.args,variableArgDefinitionsProvider:e.variableArgDefinitionsProvider??X.create([]),consumableFilter:e.consumableFilter,instructionAdvisor:e.instructionAdvisor})}lookupInstructionDefinition(t){const e=this.argumentDefinitionsByCommand.get(t);if(e===void 0)throw new Error(`No instruction defined for command ${t}`);return e}get commands(){return[...this.argumentDefinitionsByCommand.keys()]}}const g=new jt;g.registerInstruction("TAKE_FROM_WORKTOP",{args:[{valueKind:{kind:"Address",variants:["FungibleResource","NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Decimal"},name:"Amount"},{valueKind:{kind:"Bucket",mode:"produces"},name:"Bucket"}],consumableFilter:x.create({resourceAddressArgIndex:0,ownableNameArgIndex:2})});g.registerInstruction("TAKE_NON_FUNGIBLES_FROM_WORKTOP",{args:[{valueKind:{kind:"Address",variants:["NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Array",valuesKind:{kind:"NonFungibleLocalId"}},name:"IDs"},{valueKind:{kind:"Bucket",mode:"produces",variant:"NonFungible"},name:"Bucket"}],consumableFilter:x.create({resourceAddressArgIndex:0,ownableNameArgIndex:2})});g.registerInstruction("TAKE_ALL_FROM_WORKTOP",{args:[{valueKind:{kind:"Address",variants:["FungibleResource","NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Bucket",mode:"produces"},name:"Bucket"}],consumableFilter:x.create({resourceAddressArgIndex:0,ownableNameArgIndex:1})});g.registerInstruction("RETURN_TO_WORKTOP",{args:[{valueKind:{kind:"Bucket",mode:"consumes"},name:"Bucket"}],consumableFilter:Ve});g.registerInstruction("ASSERT_WORKTOP_CONTAINS",{args:[{valueKind:{kind:"Address",variants:["FungibleResource","NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Decimal"},name:"Amount"}]});g.registerInstruction("ASSERT_WORKTOP_CONTAINS_NON_FUNGIBLES",{args:[{valueKind:{kind:"Address",variants:["NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Array",valuesKind:{kind:"NonFungibleLocalId"}},name:"IDs"}]});g.registerInstruction("ASSERT_WORKTOP_CONTAINS_ANY",{args:[{valueKind:{kind:"Address",variants:["FungibleResource","NonFungibleResource"]},name:"Resource Address"}]});g.registerInstruction("POP_FROM_AUTH_ZONE",{args:[{valueKind:{kind:"Proof",mode:"produces"},name:"Proof"}],consumableFilter:x.create({resourceAddressArgIndex:void 0,ownableNameArgIndex:0})});g.registerInstruction("PUSH_TO_AUTH_ZONE",{args:[{valueKind:{kind:"Proof",mode:"consumes"},name:"Proof"}]});g.registerInstruction("CREATE_PROOF_FROM_AUTH_ZONE_OF_AMOUNT",{args:[{valueKind:{kind:"Address",variants:["FungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Decimal"},name:"Amount"},{valueKind:{kind:"Proof",mode:"produces",variant:"Fungible"},name:"Proof"}],consumableFilter:x.create({resourceAddressArgIndex:0,ownableNameArgIndex:2})});g.registerInstruction("CREATE_PROOF_FROM_AUTH_ZONE_OF_NON_FUNGIBLES",{args:[{valueKind:{kind:"Address",variants:["NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Array",valuesKind:{kind:"NonFungibleLocalId"}},name:"IDs"},{valueKind:{kind:"Proof",mode:"produces",variant:"NonFungible"},name:"Proof"}],consumableFilter:x.create({resourceAddressArgIndex:0,ownableNameArgIndex:2})});g.registerInstruction("CREATE_PROOF_FROM_AUTH_ZONE_OF_ALL",{args:[{valueKind:{kind:"Address",variants:["FungibleResource","NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Proof",mode:"produces"},name:"Proof"}],consumableFilter:x.create({resourceAddressArgIndex:0,ownableNameArgIndex:1})});g.registerInstruction("DROP_NAMED_PROOFS",{args:[],consumableFilter:Ze});g.registerInstruction("DROP_ALL_PROOFS",{args:[],consumableFilter:Ze});g.registerInstruction("DROP_AUTH_ZONE_PROOFS",{args:[]});g.registerInstruction("DROP_AUTH_ZONE_REGULAR_PROOFS",{args:[]});g.registerInstruction("DROP_AUTH_ZONE_SIGNATURE_PROOFS",{args:[]});g.registerInstruction("CREATE_PROOF_FROM_BUCKET_OF_AMOUNT",{args:[{valueKind:{kind:"Bucket",mode:"inert",variant:"Fungible"},name:"Bucket"},{valueKind:{kind:"Decimal"},name:"Amount"},{valueKind:{kind:"Proof",mode:"produces"},name:"Proof"}],consumableFilter:oe.create({bucketNameArgIndex:0,proofNameArgIndex:2})});g.registerInstruction("CREATE_PROOF_FROM_BUCKET_OF_NON_FUNGIBLES",{args:[{valueKind:{kind:"Bucket",mode:"inert",variant:"NonFungible"},name:"Bucket"},{valueKind:{kind:"Array",valuesKind:{kind:"NonFungibleLocalId"}},name:"IDs"},{valueKind:{kind:"Proof",mode:"produces"},name:"Proof"}],consumableFilter:oe.create({bucketNameArgIndex:0,proofNameArgIndex:2})});g.registerInstruction("CREATE_PROOF_FROM_BUCKET_OF_ALL",{args:[{valueKind:{kind:"Bucket",mode:"inert"},name:"Bucket"},{valueKind:{kind:"Proof",mode:"produces"},name:"Proof"}],consumableFilter:oe.create({bucketNameArgIndex:0,proofNameArgIndex:1})});g.registerInstruction("BURN_RESOURCE",{args:[{valueKind:{kind:"Bucket",mode:"consumes"},name:"Bucket"}],consumableFilter:Ve});g.registerInstruction("CLONE_PROOF",{args:[{valueKind:{kind:"Proof",mode:"inert"},name:"Proof"},{valueKind:{kind:"Proof",mode:"produces"},name:"Cloned Proof"}],consumableFilter:Bt});g.registerInstruction("DROP_PROOF",{args:[{valueKind:{kind:"Proof",mode:"consumes"},name:"Proof"}],consumableFilter:Ve});g.registerInstruction("CALL_FUNCTION",{args:[{valueKind:{kind:"Address",variants:["Package"],allowsNamedAddress:!0},name:"Package Address"},{valueKind:{kind:"String",allowBlank:!1},name:"Blueprint name"},{valueKind:{kind:"String",allowBlank:!1},name:"Function name"}],variableArgDefinitionsProvider:Zt,consumableFilter:Ae.create(T,Q),instructionAdvisor:Gt});g.registerInstruction("CALL_METHOD",{args:[{valueKind:{kind:"Address",variants:["Component","FungibleResource","NonFungibleResource"],allowsNamedAddress:!0},name:"Component Address"},{valueKind:{kind:"String",allowBlank:!1},name:"Method Name"}],variableArgDefinitionsProvider:Yt,consumableFilter:T,instructionAdvisor:zt});g.registerInstruction("ALLOCATE_GLOBAL_ADDRESS",{args:[{valueKind:{kind:"Address",variants:["Package"]},name:"Package Address"},{valueKind:{kind:"String",allowBlank:!1},name:"Blueprint Name"},{valueKind:{kind:"AddressReservation",mode:"produces"},name:"Address Reservation Name"},{valueKind:{kind:"NamedAddress",mode:"produces"},name:"Address Name"}],consumableFilter:Dt,instructionAdvisor:Wt});g.registerInstruction("PUBLISH_PACKAGE_ADVANCED",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"packagePackage",blueprintName:"Package",functionName:"publish_wasm_advanced"}),consumableFilter:Ae.create(Q,T)});g.registerInstruction("SET_METADATA",{args:[{valueKind:{kind:"Address",allowsNamedAddress:!0},name:"Entity Address"}],variableArgDefinitionsProvider:X.create([{valueKind:{kind:"String",allowBlank:!1},name:"Field Name"},{valueKind:{kind:"WellKnownReference",name:"METADATA_VALUE"},name:"Value"}])});g.registerInstruction("LOCK_METADATA",{args:[{valueKind:{kind:"Address",allowsNamedAddress:!0},name:"Address"}],variableArgDefinitionsProvider:X.create([{valueKind:{kind:"String",allowBlank:!1},name:"Field Name"}])});g.registerInstruction("REMOVE_METADATA",{args:[{valueKind:{kind:"Address",allowsNamedAddress:!0},name:"Address"}],variableArgDefinitionsProvider:X.create([{valueKind:{kind:"String",allowBlank:!1},name:"Field Name"}])});g.registerInstruction("MINT_FUNGIBLE",{args:[{valueKind:{kind:"Address",variants:["FungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Decimal"},name:"Amount"}]});g.registerInstruction("MINT_NON_FUNGIBLE",{args:[{valueKind:{kind:"Address",variants:["NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Map",keysKind:{kind:"NonFungibleLocalId"},valuesKind:{kind:"Tuple"}},name:"Non Fungibles"}]});g.registerInstruction("MINT_RUID_NON_FUNGIBLE",{args:[{valueKind:{kind:"Address",variants:["NonFungibleResource"]},name:"Resource Address"},{valueKind:{kind:"Array",valuesKind:{kind:"Tuple"}},name:"Non Fungibles"}]});g.registerInstruction("CREATE_FUNGIBLE_RESOURCE",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"resourcePackage",blueprintName:"FungibleResourceManager",functionName:"create"}),consumableFilter:T});g.registerInstruction("CREATE_FUNGIBLE_RESOURCE_WITH_INITIAL_SUPPLY",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"resourcePackage",blueprintName:"FungibleResourceManager",functionName:"create_with_initial_supply"}),consumableFilter:T});g.registerInstruction("CREATE_NON_FUNGIBLE_RESOURCE",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"resourcePackage",blueprintName:"NonFungibleResourceManager",functionName:"create"}),consumableFilter:T});g.registerInstruction("CREATE_NON_FUNGIBLE_RESOURCE_WITH_INITIAL_SUPPLY",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"resourcePackage",blueprintName:"NonFungibleResourceManager",functionName:"create_with_initial_supply"}),consumableFilter:T});g.registerInstruction("RECALL_FROM_VAULT",{args:[{valueKind:{kind:"Address",variants:["FungibleVault","NonFungibleVault"]},name:"Vault Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"resourcePackage",blueprintName:"FungibleVault",functionName:"recall"})});g.registerInstruction("RECALL_NON_FUNGIBLES_FROM_VAULT",{args:[{valueKind:{kind:"Address",variants:["NonFungibleVault"]},name:"Vault Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"resourcePackage",blueprintName:"NonFungibleVault",functionName:"recall_non_fungibles"})});g.registerInstruction("FREEZE_VAULT",{args:[{valueKind:{kind:"Address",variants:["FungibleVault","NonFungibleVault"]},name:"Vault Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"resourcePackage",blueprintName:"FungibleVault",functionName:"freeze"})});g.registerInstruction("UNFREEZE_VAULT",{args:[{valueKind:{kind:"Address",variants:["FungibleVault","NonFungibleVault"]},name:"Vault Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"resourcePackage",blueprintName:"FungibleVault",functionName:"unfreeze"})});g.registerInstruction("SET_OWNER_ROLE",{args:[{valueKind:{kind:"Address",allowsNamedAddress:!0},name:"Entity Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"roleAssignmentModulePackage",blueprintName:"RoleAssignment",functionName:"set_owner"})});g.registerInstruction("LOCK_OWNER_ROLE",{args:[{valueKind:{kind:"Address",allowsNamedAddress:!0},name:"Entity Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"roleAssignmentModulePackage",blueprintName:"RoleAssignment",functionName:"lock_owner"})});g.registerInstruction("SET_ROLE",{args:[{valueKind:{kind:"Address",allowsNamedAddress:!0},name:"Entity Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"roleAssignmentModulePackage",blueprintName:"RoleAssignment",functionName:"set"}),instructionAdvisor:Ht});g.registerInstruction("CREATE_ACCESS_CONTROLLER",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"accessControllerPackage",blueprintName:"AccessController",functionName:"create"}),consumableFilter:T});g.registerInstruction("SET_COMPONENT_ROYALTY",{args:[{valueKind:{kind:"Address",variants:["Component"],allowsNamedAddress:!0},name:"Component Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"royaltyModulePackage",blueprintName:"ComponentRoyalty",functionName:"set_royalty"}),instructionAdvisor:Ne.create({addressArgIndex:0,methodNameArgIndex:1})});g.registerInstruction("LOCK_COMPONENT_ROYALTY",{args:[{valueKind:{kind:"Address",variants:["Component"],allowsNamedAddress:!0},name:"Component Address"}],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"royaltyModulePackage",blueprintName:"ComponentRoyalty",functionName:"lock_royalty"}),instructionAdvisor:Ne.create({addressArgIndex:0,methodNameArgIndex:1})});g.registerInstruction("CLAIM_PACKAGE_ROYALTIES",{args:[{valueKind:{kind:"Address",variants:["Package"],allowsNamedAddress:!0},name:"Package Address"}]});g.registerInstruction("CLAIM_COMPONENT_ROYALTIES",{args:[{valueKind:{kind:"Address",variants:["Component"],allowsNamedAddress:!0},name:"Component Address"}]});g.registerInstruction("CREATE_ACCOUNT",{args:[]});g.registerInstruction("CREATE_ACCOUNT_ADVANCED",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"accountPackage",blueprintName:"Account",functionName:"create_advanced"}),consumableFilter:T});g.registerInstruction("CREATE_IDENTITY",{args:[]});g.registerInstruction("CREATE_IDENTITY_ADVANCED",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"identityPackage",blueprintName:"Identity",functionName:"create_advanced"})});g.registerInstruction("CREATE_VALIDATOR",{args:[],variableArgDefinitionsProvider:F.create({wellKnownPackageName:"consensusManagerPackage",blueprintName:"ConsensusManager",functionName:"create_validator"}),consumableFilter:T});class w{constructor(t,e,n){d(this,"consumedInputs");this.valueKind=t,this.value=e,this.instruction=n}isEmbeddable(){return!1}getChildValueNodes(){return[]}}class je extends w{constructor(e){super({kind:void 0},f(""),e);d(this,"validationResult",f(Promise.resolve(A.error({message:"Value kind not selected",context:"ValueNode"}))))}reset(){this.value.set("")}async toManifestString(){return"???"}initializeFromProgrammaticValue(e){}initializeFromPersistentValue(e){}toPersistableValue(){return{kind:"Any"}}}class Jt extends w{constructor(e,n){super(e,f(null),n);d(this,"validationResult");this.validationResult=v(this.value,async s=>s==null?A.error({message:"Value missing",context:"ValueNode"}):s!=="true"&&s!=="false"?A.error({message:`${s} is not a valid boolean`,context:"ValueNode"}):A.ok())}reset(){this.value.set(null)}async toManifestString(){return`${l(this.value)}`}isEmbeddable(){return!0}initializeFromProgrammaticValue(e){this.value.set(`${e.value}`)}initializeFromPersistentValue(e){this.value.set(e.value)}toPersistableValue(){return{kind:"Bool",value:l(this.value)}}}class R extends w{constructor(e,n){super(e,f(""),n);d(this,"validationResult");this.validationResult=v(this.value,async s=>{if(!s)return A.error({message:"Value missing",context:"ValueNode"});try{const i=BigInt(s);return mt.get(this.valueKind.kind).validate(i)}catch{return A.error({message:"Cannot parse integer",context:"ValueNode"})}})}reset(){this.value.set("")}async toManifestString(){return`${l(this.value)}${this.valueKind.kind.toLowerCase()}`}isEmbeddable(){return!0}initializeFromProgrammaticValue(e){this.value.set(e.value.toString())}initializeFromPersistentValue(e){this.value.set(e.value)}toPersistableValue(){return{kind:this.valueKind.kind,value:l(this.value)}}}class qt extends w{constructor(e,n){super(e,f(""),n);d(this,"options",f(void 0));d(this,"validationResult");this.validationResult=v([this.value,this.options],async([s,i])=>i!=null?i.includes(s)?A.ok():A.error({message:"Value missing",context:"ValueNode"}):(this.valueKind.allowBlank??!0)||!gt(s)?A.ok():A.error({message:"Value missing",context:"ValueNode"}))}setOptions(e){const n=e.toSorted(),s=l(this.options);if(!he.isEqual(n,s)){this.options.set(n);const i=l(this.value);e.includes(i)||this.value.set("")}}clearOptions(){var n;(((n=l(this.options))==null?void 0:n.length)??0)!==0&&this.options.set(void 0)}reset(){this.value.set(""),this.clearOptions()}async toManifestString(){return`"${l(this.value)}"`}isEmbeddable(){return!0}initializeFromProgrammaticValue(e){this.value.set(e.value)}initializeFromPersistentValue(e){this.value.set(e.value)}toPersistableValue(){return{kind:"String",value:l(this.value)}}}const G=class G extends w{constructor(e,n){super(e,f({variant:e.variant,value:""}),n);d(this,"validationResult");this.validationResult=v(this.value,async s=>{if(s.value.trim()==="")return A.error({message:"Value missing",context:"ValueNode"});const i=s.variant;return i==null?A.error({message:"No NonFungibleLocalId variant selected",context:"ValueNode"}):vt(i,s.value)})}reset(){this.value.set({variant:this.valueKind.variant,value:""})}async toManifestString(){return`NonFungibleLocalId("${G.mapNonFungibleLocalIdToString(l(this.value))}")`}static mapNonFungibleLocalIdToString(e){const[n,s]=e.variant?G.variantAffixes[e.variant]:["?","?"];return`${n}${e.value}${s}`}static parseTypeAndValue(e){const n=e[0],s=e.slice(1,-1);switch(n){case"<":return["String",s];case"#":return["Integer",s];case"[":return["Bytes",s];case"{":return["Ruid",s];default:throw new Error(`Invalid NonFungibleLocalId prefix: ${n}`)}}initializeFromProgrammaticValue(e,n){const[s,i]=G.parseTypeAndValue(e.value);this.value.set({variant:s,value:i})}initializeFromPersistentValue(e){this.value.set({value:e.value,variant:e.variant})}toPersistableValue(){const e=l(this.value);return{kind:"NonFungibleLocalId",value:e.value,variant:e.variant}}};d(G,"variantAffixes",{String:["<",">"],Integer:["#","#"],Bytes:["[","]"],Ruid:["{","}"]});let $=G;function Xt(a,t){const e=fe(),n=Qt(a,t,e);return[e,n]}async function Qt(a,t,e){const n=new we(e);n.label.set(t);const s=a.instructions;if(s.kind!=="Parsed")throw new Error("Manifest required to be in parsed form");const i=new ss;for(let r=0;r<s.value.length;r++){const o=s.value[r],u=es(o),c=n.insertNewInstruction(r);c.command.set(u),await $t(o,c,i)}return n}async function $t(a,t,e){const n=l(t.fixedArgs);function s(i){return n[i].value.currentValueNode()}switch(a.kind){case"TakeAllFromWorktop":s(0).value.set(a.resourceAddress),s(1).value.set(e.idForNewlyProducedOwnable("Bucket"));break;case"TakeFromWorktop":s(0).value.set(a.resourceAddress),s(1).initializeFromDecimal(a.amount),s(2).value.set(e.idForNewlyProducedOwnable("Bucket"));break;case"TakeNonFungiblesFromWorktop":s(0).value.set(a.resourceAddress),ue(s(1),a.ids),s(2).value.set(e.idForNewlyProducedOwnable("Bucket"));break;case"ReturnToWorktop":s(0).value.set(e.idForExistingOwnable("Bucket",a.bucketId));break;case"AssertWorktopContainsAny":s(0).value.set(a.resourceAddress);break;case"AssertWorktopContains":s(0).value.set(a.resourceAddress),s(1).initializeFromDecimal(a.amount);break;case"AssertWorktopContainsNonFungibles":s(0).value.set(a.resourceAddress),ue(s(1),a.ids);break;case"PopFromAuthZone":s(0).value.set(e.idForNewlyProducedOwnable("Proof"));break;case"PushToAuthZone":s(0).value.set(e.idForExistingOwnable("Proof",a.proofId));break;case"DropAuthZoneProofs":break;case"CreateProofFromAuthZoneOfAmount":s(0).value.set(a.resourceAddress),s(1).initializeFromDecimal(a.amount),s(2).value.set(e.idForNewlyProducedOwnable("Proof"));break;case"CreateProofFromAuthZoneOfNonFungibles":s(0).value.set(a.resourceAddress),ue(s(1),a.ids),s(2).value.set(e.idForNewlyProducedOwnable("Proof"));break;case"CreateProofFromAuthZoneOfAll":s(0).value.set(a.resourceAddress),s(1).value.set(e.idForNewlyProducedOwnable("Proof"));break;case"DropNamedProofs":break;case"DropAuthZoneRegularProofs":break;case"DropAuthZoneSignatureProofs":break;case"CreateProofFromBucketOfAmount":s(0).value.set(e.idForExistingOwnable("Bucket",a.bucketId)),s(1).initializeFromDecimal(a.amount),s(2).value.set(e.idForNewlyProducedOwnable("Proof"));break;case"CreateProofFromBucketOfNonFungibles":s(0).value.set(e.idForExistingOwnable("Bucket",a.bucketId)),ue(s(1),a.ids),s(2).value.set(e.idForNewlyProducedOwnable("Proof"));break;case"CreateProofFromBucketOfAll":s(0).value.set(e.idForExistingOwnable("Bucket",a.bucketId)),s(1).value.set(e.idForNewlyProducedOwnable("Proof"));break;case"BurnResource":s(0).value.set(e.idForExistingOwnable("Bucket",a.bucketId));break;case"CloneProof":s(0).value.set(e.idForExistingOwnable("Proof",a.proofId)),s(1).value.set(e.idForNewlyProducedOwnable("Proof"));break;case"DropProof":s(0).value.set(e.idForExistingOwnable("Proof",a.proofId));break;case"CallFunction":if(s(0).value.set(Pe(a.packageAddress,e)),s(1).value.set(a.blueprintName),s(2).value.set(a.functionName),a.args.kind!==z.Tuple)throw new Error(`Invalid args kind: ${a.args.kind}`);await de(t,a.args.fields,e);break;case"CallMethod":if(s(0).value.set(Pe(a.address,e)),s(1).value.set(a.methodName),a.args.kind!==z.Tuple)throw new Error(`Invalid args kind: ${a.args.kind}`);await de(t,a.args.fields,e);break;case"CallRoyaltyMethod":case"CallMetadataMethod":case"CallRoleAssignmentMethod":if(s(0).value.set(Pe(a.address,e)),a.args.kind!==z.Tuple)throw new Error(`Invalid args kind: ${a.args.kind}`);await de(t,a.args.fields,e);break;case"CallDirectVaultMethod":if(s(0).value.set(a.address),a.args.kind!==z.Tuple)throw new Error(`Invalid args kind: ${a.args.kind}`);await de(t,a.args.fields,e);break;case"DropAllProofs":break;case"AllocateGlobalAddress":s(0).value.set(a.packageAddress),s(1).value.set(a.blueprintName),s(2).value.set(e.idForNewlyProducedOwnable("AddressReservation")),s(3).value.set(e.idForNewlyProducedOwnable("NamedAddress"));break;default:throw new Error(`Unhandled instruction kind: ${a.kind}`)}}function es(a){if(a.kind==="CallRoyaltyMethod")switch(a.methodName){case"set_royalty":return"SET_COMPONENT_ROYALTY";case"lock_royalty":return"LOCK_COMPONENT_ROYALTY";case"claim_royalties":return"CLAIM_COMPONENT_ROYALTIES";default:throw new Error(`Unhandled CallRoyaltyMethod: ${a.methodName}`)}if(a.kind==="CallMetadataMethod")switch(a.methodName){case"set":return"SET_METADATA";case"lock":return"LOCK_METADATA";case"remove":return"REMOVE_METADATA";default:throw new Error(`Unhandled CallMetadataMethod: ${a.methodName}`)}if(a.kind==="CallRoleAssignmentMethod")switch(a.methodName){case"set":return"SET_ROLE";case"set_owner":return"SET_OWNER_ROLE";case"lock_owner":return"LOCK_OWNER_ROLE";default:throw new Error(`Unhandled CallRoleAssignmentMethod: ${a.methodName}`)}if(a.kind==="CallDirectVaultMethod")switch(a.methodName){case"freeze":return"FREEZE_VAULT";case"unfreeze":return"UNFREEZE_VAULT";case"recall":return a.args.kind==="Tuple"&&a.args.fields[0].kind==="Decimal"?"RECALL_FROM_VAULT":"RECALL_NON_FUNGIBLE";default:throw new Error(`Unhandled CallRoleAssignmentMethod: ${a.methodName}`)}return ts[a.kind]}const ts={TakeAllFromWorktop:"TAKE_ALL_FROM_WORKTOP",TakeFromWorktop:"TAKE_FROM_WORKTOP",TakeNonFungiblesFromWorktop:"TAKE_NON_FUNGIBLES_FROM_WORKTOP",ReturnToWorktop:"RETURN_TO_WORKTOP",AssertWorktopContainsAny:"ASSERT_WORKTOP_CONTAINS_ANY",AssertWorktopContains:"ASSERT_WORKTOP_CONTAINS",AssertWorktopContainsNonFungibles:"ASSERT_WORKTOP_CONTAINS_NON_FUNGIBLES",PopFromAuthZone:"POP_FROM_AUTH_ZONE",PushToAuthZone:"PUSH_TO_AUTH_ZONE",DropAuthZoneProofs:"DROP_AUTH_ZONE_PROOFS",CreateProofFromAuthZoneOfAmount:"CREATE_PROOF_FROM_AUTH_ZONE_OF_AMOUNT",CreateProofFromAuthZoneOfNonFungibles:"CREATE_PROOF_FROM_AUTH_ZONE_OF_NON_FUNGIBLES",CreateProofFromAuthZoneOfAll:"CREATE_PROOF_FROM_AUTH_ZONE_OF_ALL",DropNamedProofs:"DROP_NAMED_PROOFS",DropAuthZoneRegularProofs:"DROP_AUTH_ZONE_REGULAR_PROOFS",DropAuthZoneSignatureProofs:"DROP_AUTH_ZONE_SIGNATURE_PROOFS",CreateProofFromBucketOfAmount:"CREATE_PROOF_FROM_BUCKET_OF_AMOUNT",CreateProofFromBucketOfNonFungibles:"CREATE_PROOF_FROM_BUCKET_OF_NON_FUNGIBLES",CreateProofFromBucketOfAll:"CREATE_PROOF_FROM_BUCKET_OF_ALL",BurnResource:"BURN_RESOURCE",CloneProof:"CLONE_PROOF",DropProof:"DROP_PROOF",CallFunction:"CALL_FUNCTION",CallMethod:"CALL_METHOD",CallRoyaltyMethod:"CALL_ROYALTY_METHOD",CallMetadataMethod:"CALL_METADATA_METHOD",CallRoleAssignmentMethod:"CALL_ROLE_ASSIGNMENT_METHOD",CallDirectVaultMethod:"CALL_DIRECT_VAULT_METHOD",DropAllProofs:"DROP_ALL_PROOFS",AllocateGlobalAddress:"ALLOCATE_GLOBAL_ADDRESS"};class ss{constructor(){d(this,"ownValueCounts",new Map)}idForNewlyProducedOwnable(t){const e=this.ownValueCounts.get(t)??0;return this.ownValueCounts.set(t,e+1),`${t.toLowerCase()}_${e}`}idForExistingOwnable(t,e){return`${t.toLowerCase()}_${e}`}}function Pe(a,t){return a.kind==="Static"?a.value:t.idForExistingOwnable("NamedAddress",a.value)}function ue(a,t){const e=a.value;for(const n of t){const[s,i]=$.parseTypeAndValue(n);l(e.insertNewElement().valueNode).value.set({variant:s,value:i})}}async function de(a,t,e){const n=await l(a.variableArgs)??[];for(let s=0;s<t.length;s++){const i=t[s];(n[s]??a.addArgument(Y(i.kind,"consumes"))).value.initializeFromProgrammaticValue(i,e)}}function ee(a,t){return a==="Bucket"||a==="Proof"||a==="NamedAddress"||a==="AddressReservation"?{kind:a,mode:t}:{kind:a}}class B extends w{constructor(e,n){var s,i;super(e,B.createNewCompositeValue(e,n),n);d(this,"canBeReplacedWithExpressionEntireWorktop");d(this,"canBeReplacedWithExpressionEntireAuthZone");d(this,"replaceWithExpressionInitial");d(this,"replaceWithExpression");d(this,"validationResult");this.canBeReplacedWithExpressionEntireWorktop=e.kind==="Array"&&((s=e.valuesKind)==null?void 0:s.kind)==="Bucket",this.canBeReplacedWithExpressionEntireAuthZone=e.kind==="Array"&&((i=e.valuesKind)==null?void 0:i.kind)==="Proof",this.replaceWithExpressionInitial=this.canBeReplacedWithExpressionEntireWorktop||this.canBeReplacedWithExpressionEntireAuthZone,this.replaceWithExpression=f(this.replaceWithExpressionInitial),this.replaceWithExpression.subscribe(r=>{r&&this.value.reset()}),this.validationResult=this.value.validationResult,this.consumedInputs=this.value.consumedInputs}get canBeReplacedWithExpression(){return this.canBeReplacedWithExpressionEntireWorktop||this.canBeReplacedWithExpressionEntireAuthZone}static createNewCompositeValue(e,n){if(e.kind==="Array")return new ns(e,n);if(e.kind==="Map")return new is(e,n);if(e.kind==="Tuple")return new as(e,n);if(e.kind==="Enum")return new rs(e,n);throw new Error("Unhandled value kind: "+e)}reset(){this.replaceWithExpression.set(this.replaceWithExpressionInitial),this.value=B.createNewCompositeValue(this.valueKind,this.instruction)}async toManifestString(){if(l(this.replaceWithExpression)){if(this.canBeReplacedWithExpressionEntireWorktop)return'Expression("ENTIRE_WORKTOP")';if(this.canBeReplacedWithExpressionEntireAuthZone)return'Expression("ENTIRE_AUTH_ZONE")'}return this.value.toManifestString()}isEmbeddable(){var e,n;return this.valueKind.kind==="Tuple"&&((n=(e=this.valueKind)==null?void 0:e.elementKinds)==null?void 0:n.length)===1&&this.value.isEmbeddable()}initializeFromProgrammaticValue(e,n){e.kind==="Expression"?this.replaceWithExpression.set(!0):(this.replaceWithExpression.set(!1),this.value.initializeFromProgrammaticValue(e,n))}initializeFromPersistentValue(e){e.replaceWithExpression?this.replaceWithExpression.set(!0):(this.replaceWithExpression.set(!1),this.value.initializeFromPersistentValue(e))}toPersistableValue(){return l(this.replaceWithExpression)?{kind:"Array",replaceWithExpression:!0,valuesKind:this.canBeReplacedWithExpressionEntireWorktop?"Bucket":"Proof"}:{...this.value.toPersistableValue(),replaceWithExpression:!1}}getChildValueNodes(){return this.value.getChildValueNodes().flatMap(n=>[n,...n.getChildValueNodes()])}}class ns{constructor(t,e){d(this,"valuesKind");d(this,"values");d(this,"typeNameWithGenerics");d(this,"validationResult");d(this,"consumedInputs");this.valueKind=t,this.instruction=e,this.valuesKind=f(t.valuesKind?j(t.valuesKind,"consumes"):void 0),this.values=f([]),this.typeNameWithGenerics=v(this.valuesKind,s=>{const i=Ee(s);return`Array<${(i==null?void 0:i.kind)??"?"}>`});const n=se(this.values,s=>s.map(i=>i.validationResult));this.validationResult=v([this.valuesKind,n],async([s,i])=>ge(s)?A.error({message:"Array type missing",context:"ValueNode"}):i),this.consumedInputs=v(ne(this.values,s=>q(s.flatMap(i=>i.consumedInputs))),Z.flatten)}size(){return v(this.values,t=>t.length)}reset(){this.valuesKind.set(this.valueKind.valuesKind),this.values.set([])}async toManifestString(){let t=l(this.values);const e=l(this.valuesKind),n=(e&&Je(e))??!1;let s=(await Promise.all(t.map(async i=>n?i.toManifestString():ie(await i.toManifestString(),ae)))).join(n?", ":`,
`);return!n&&t.length>0&&(s=`
${s}
`),`${l(this.typeNameWithGenerics)}(${s})`}insertNewElement(){const t=l(this.valuesKind);if(t==null)throw new Error("Cannot create a new array element when the element kind is unknown");const e=y(t,this.instruction);return this.values.set([...l(this.values),e]),e}initializeFromProgrammaticValue(t,e){this.reset(),this.valuesKind.set(Y(t.elementValueKind,"consumes"));for(const n of t.elements)this.insertNewElement().initializeFromProgrammaticValue(n,e)}initializeFromPersistentValue(t){this.valuesKind.set({kind:t.valuesKind});for(const e of t.values)this.insertNewElement().initializeFromPersistentValue(e)}toPersistableValue(){var t;return{kind:"Array",valuesKind:((t=l(this.valuesKind))==null?void 0:t.kind)??"Any",values:l(this.values).map(e=>e.toPersistableValue())}}getChildValueNodes(){return l(this.values).map(t=>t.currentValueNode())}}class is{constructor(t,e){d(this,"keysKind");d(this,"valuesKind");d(this,"entries");d(this,"typeNameWithGenerics");d(this,"validationResult");d(this,"consumedInputs");this.valueKind=t,this.instruction=e,this.keysKind=f(t.keysKind?j(t.keysKind,"consumes"):void 0),this.valuesKind=f(t.valuesKind?j(t.valuesKind,"consumes"):void 0),this.entries=f([]),this.typeNameWithGenerics=v([this.keysKind,this.valuesKind],([s,i])=>{const r=Ee(s),o=Ee(i);return`Map<${(r==null?void 0:r.kind)??"?"}, ${(o==null?void 0:o.kind)??"?"}>`});const n=se(this.entries,s=>s.flatMap(i=>[i.key.validationResult,i.value.validationResult]));this.validationResult=v([this.keysKind,this.valuesKind,n],async([s,i,r])=>{const o=[];return ge(s)&&o.push({message:"Key type missing",context:"ValueNode"}),ge(i)&&o.push({message:"Value type missing",context:"ValueNode"}),new A([...o,...(await r).errors])}),this.consumedInputs=v(ne(this.entries,s=>s.flatMap(({key:i,value:r})=>q([i.consumedInputs,r.consumedInputs]))),Z.flatten)}size(){return v(this.entries,t=>t.length)}reset(){this.keysKind.set(this.valueKind.keysKind),this.valuesKind.set(this.valueKind.valuesKind),this.entries.set([])}async toManifestString(){const t=l(this.valuesKind),e=(t&&Je(t))??!1;let n=(await Promise.all(l(this.entries).map(async({key:s,value:i})=>{let r=`${await s.toManifestString()} => ${await i.toManifestString()}`;return e?r:ie(r,ae)}))).join(e?", ":`,
`);return e&&(n=`
${n}
`),`${l(this.typeNameWithGenerics)}(${n})`}insertNewEntry(){const t=l(this.keysKind),e=l(this.valuesKind);if(t==null||e==null)throw new Error("Cannot create a new map element when the keys or values kind is unknown");const n=y(t,this.instruction),s=y(e,this.instruction),i={key:n,value:s};return this.entries.set([...l(this.entries),i]),i}initializeFromProgrammaticValue(t,e){this.reset(),this.keysKind.set(Y(t.keyValueKind,"consumes")),this.valuesKind.set(Y(t.valueValueKind,"consumes"));for(const n of t.entries){const{key:s,value:i}=this.insertNewEntry();s.initializeFromProgrammaticValue(n.key,e),i.initializeFromProgrammaticValue(n.value,e)}}initializeFromPersistentValue(t){this.keysKind.set(ee(t.keysKind,"consumes")),this.valuesKind.set(ee(t.valuesKind,"consumes"));for(const e of t.entries){const{key:n,value:s}=this.insertNewEntry();n.initializeFromPersistentValue(e.key),s.initializeFromPersistentValue(e.value)}}toPersistableValue(){var t,e;return{kind:"Map",keysKind:((t=l(this.keysKind))==null?void 0:t.kind)??"Any",valuesKind:((e=l(this.valuesKind))==null?void 0:e.kind)??"Any",entries:l(this.entries).map(({key:n,value:s})=>({key:n.toPersistableValue(),value:s.toPersistableValue()}))}}getChildValueNodes(){return l(this.entries).flatMap(({key:t,value:e})=>[t.currentValueNode(),e.currentValueNode()])}}class as{constructor(t,e){d(this,"values");d(this,"typeNameWithGenerics",me(f("Tuple")));d(this,"elementKinds");d(this,"elementNames");d(this,"validationResult");d(this,"consumedInputs");var s;this.instruction=e;const n=(s=t.elementKinds)==null?void 0:s.map(i=>y(i,e));this.values=f(n??[]),this.elementKinds=me(f(t.elementKinds)),this.elementNames=me(f(t.elementNames)),this.validationResult=se(this.values,i=>i.map(r=>r.validationResult)),this.consumedInputs=v(ne(this.values,i=>q(i.flatMap(r=>r.consumedInputs))),Z.flatten)}size(){return v(this.values,t=>t.length)}reset(){l(this.values).forEach(t=>t.currentValueNode().reset())}async toManifestString(){let t=l(this.values),e=(await Promise.all(t.map(async n=>ie(await n.toManifestString(),ae)))).join(`,
`);return t.length>0&&(e=`
${e}
`),`${l(this.typeNameWithGenerics)}(${e})`}isEmbeddable(){var t;return(t=l(this.values)[0])==null?void 0:t.isEmbeddable()}initializeFromProgrammaticValue(t,e){const n=l(this.values),s=t.fields;for(let i=0;i<s.length;i++){const r=s[i];(n[i]??this.addNewValue(Y(r.kind,"consumes"),!0)).initializeFromProgrammaticValue(r,e)}}initializeFromPersistentValue(t){const e=l(this.values),n=t.values;for(let s=0;s<n.length;s++){const i=n[s];(e[s]??this.addNewValue(ee(i.kind,"consumes"),!0)).initializeFromPersistentValue(i)}}addNewValue(t,e){const n=y(t,this.instruction,e);return this.values.update(s=>(s.push(n),s)),n}toPersistableValue(){return{kind:"Tuple",values:l(this.values).map(t=>t.toPersistableValue())}}getChildValueNodes(){return l(this.values).map(t=>t.currentValueNode())}}class rs{constructor(t,e){d(this,"discriminatorValue");d(this,"values");d(this,"typeNameWithGenerics");d(this,"elementKinds");d(this,"elementNames");d(this,"validationResult");d(this,"consumedInputs");this.instruction=e,this.discriminatorValue=f(void 0),this.values=f(n(l(this.discriminatorValue)??-1)??[]),this.typeNameWithGenerics=v(this.discriminatorValue,i=>{const r=i==null?void 0:i.toString();return`Enum<${ht(r,"?")}u8>`}),this.elementKinds=v(this.discriminatorValue,i=>{var o;const r=(o=t.variants)==null?void 0:o.get(i??-1);return r==null?void 0:r.elementKinds}),this.elementNames=v(this.discriminatorValue,i=>{var o;const r=(o=t.variants)==null?void 0:o.get(i??-1);return r==null?void 0:r.elementNames}),this.discriminatorValue.subscribe(i=>{const r=n(i??-1);r!==void 0&&this.values.set(r)});function n(i){var o,u;const r=(o=t.variants)==null?void 0:o.get(i);return(u=r==null?void 0:r.elementKinds)==null?void 0:u.map(c=>y(c,e))}const s=se(this.values,i=>i.map(r=>r.validationResult));this.validationResult=v([this.discriminatorValue,s],async([i,r])=>{if(ge(i))return A.error({message:"Enum variant not selected",context:"ValueNode"});const u=(await Promise.all(l(this.values).map(c=>l(c.validationResult)))).flatMap(c=>c.errors);return new A(u)}),this.consumedInputs=v(ne(this.values,i=>q(i.flatMap(r=>r.consumedInputs))),Z.flatten)}size(){return v(this.values,t=>t.length)}reset(){this.discriminatorValue.set(void 0),this.values.set([])}async toManifestString(){const t=l(this.values);let e=(await Promise.all(t.map(async n=>ie(await n.toManifestString(),ae)))).join(`,
`);return t.length>0&&(e=`
${e}
`),`${l(this.typeNameWithGenerics)}(${e})`}initializeFromProgrammaticValue(t,e){this.discriminatorValue.set(t.discriminator);const n=l(this.values),s=t.fields;for(let i=0;i<s.length;i++){const r=s[i];(n[i]??this.addNewValue(Y(r.kind,"consumes"),!0)).initializeFromProgrammaticValue(r,e)}}initializeFromPersistentValue(t){this.discriminatorValue.set(t.discriminatorValue);const e=l(this.values),n=t.values;for(let s=0;s<n.length;s++){const i=n[s];(e[s]??this.addNewValue(ee(i.kind,"consumes"),!0)).initializeFromPersistentValue(i)}}addNewValue(t,e){const n=y(t,this.instruction,e);return this.values.update(s=>(s.push(n),s)),n}toPersistableValue(){return{kind:"Enum",discriminatorValue:l(this.discriminatorValue),values:l(this.values).map(t=>t.toPersistableValue())}}getChildValueNodes(){return l(this.values).map(t=>t.currentValueNode())}}function Je(a){return new Set(["Bool","I8","I16","I32","I64","U8","U16","U32","U64","String"]).has(a.kind)}async function Ms(a){const t=await _.ManifestSbor.decodeToString(a,I,Ue.ManifestString),s={kind:"String",value:`
            CALL_FUNCTION
              Address("${(await _.Utils.knownAddresses(I)).packageAddresses.packagePackage}")
              "Package"
              "publish_wasm"
              ${t}
              Bytes("")
              Map<String, Tuple>()
            ;
        `},i=await _.Instructions.convert(s,I,"Parsed");if(i.kind!=="Parsed")throw new Error("Unreachable");const r=i.value[0];if(r.kind!=="CallFunction")throw new Error("Unreachable");if(r.args.kind!==z.Tuple)throw new Error("Unreachable");return r.args.fields[0]}class os extends w{constructor(e,n){super(e,f(""),n);d(this,"validationResult");d(this,"availableNamedAddresses",v(this.instruction.inputs,e=>e.filter(n=>n.kind==="NamedAddress")));d(this,"isValueNamedAddress",v([this.value,ve(this.instruction.inputs)],([e,n])=>n.find(s=>s.kind==="NamedAddress"&&s.name===e)!==void 0));d(this,"validStaticOrNamedAddress");this.validStaticOrNamedAddress=v([this.value,this.instruction.inputs],async([s,i])=>{var o;const r=i.find(u=>u.kind==="AddressReservation"&&u.namedAddressName===s);if((r==null?void 0:r.kind)==="AddressReservation"&&r.namedAddressName)return{kind:"named",addressName:r.namedAddressName,addressReservationName:r.name,packageAddress:r.packageAddress,blueprintName:r.blueprintName};try{const{networkId:u,entityType:c}=await _.Address.decode(s),m=ft(c);return u!==I||(o=this.valueKind.variants)!=null&&o.length&&!this.valueKind.variants.includes(m)?void 0:{kind:"static",address:s,entityVariant:m}}catch{return}}),this.validStaticOrNamedAddress.subscribe(async s=>{const i=await s;(i==null?void 0:i.kind)==="static"&&await re.useEntity(i.address)}),this.validationResult=At([this.value,this.isValueNamedAddress],async([s,i])=>((s==null?void 0:s.trim())??"")===""?A.error({message:"Value missing",context:"ValueNode"}):i?A.ok():ze(s,this.valueKind.variants))}reset(){this.value.set("")}async toManifestString(){var n;return((n=await l(this.validStaticOrNamedAddress))==null?void 0:n.kind)==="named"?`NamedAddress("${l(this.value)}")`:`Address("${l(this.value)}")`}isEmbeddable(){return!0}initializeFromProgrammaticValue(e,n){const s=e.value;s.kind==="Static"?this.value.set(s.value):this.value.set(n.idForExistingOwnable("NamedAddress",s.value))}initializeFromPersistentValue(e){this.value.set(e.value)}toPersistableValue(){return{kind:"Address",value:l(this.value)}}}class ce extends w{constructor(e,n){super(e,f(""),n);d(this,"validationResult");d(this,"selectableInputs");this.selectableInputs=v(this.instruction.inputs,s=>s.filter(i=>{const r=e.kind;return i.kind===r&&!i.isConsumed})),this.validationResult=v([this.value,n.inputs,n.manifestNode.danglingOutputs,n.argConsumedInputs],async([s,i,r,o])=>{const u=this.valueKind.kind,c=u==="Bucket"||u==="Proof"?this.valueKind.variant:void 0,m=u==="Bucket"||u==="Proof"?`${this.valueKind.variant??""}${u}`:u;if(s)if(this.valueKind.mode==="consumes"||this.valueKind.mode==="inert"){const h=i.find(N=>N.kind===u&&N.name===s),b=(h==null?void 0:h.kind)==="Bucket"||(h==null?void 0:h.kind)==="Proof"?await h.resourceVariant:void 0;return h?c&&b&&c!==b?A.error({message:`Requires a ${m} but ${u} ${s} is ${b}`,context:"ValueNode"}):h.isConsumed?A.error({message:`${m} ${s} is already consumed by another instruction`,context:"ValueNode"}):o.filter(p=>p.kind===u&&p.name===s).length>1?A.error({message:`${m} ${s} cannot be consumed multiple times`,context:"ValueNode"}):A.ok():A.error({message:`A ${m} with name ${s} is not defined`,context:"ValueNode"})}else return this.valueKind.mode==="produces"?i.find(N=>N.kind===u&&N.name===s)!=null?A.error({message:`A ${m} with name ${s} is already defined`,context:"ValueNode"}):r.find(N=>N.kind===u&&N.name===s)?A.error({message:`${m} ${s} is dangling`,context:"ValueNode"}):A.ok():A.ok();else return this.valueKind.mode==="produces"?A.error({message:"Identifier missing",context:"ValueNode"}):A.error({message:`${this.valueKind.kind} missing`,context:"ValueNode"})}),this.consumedInputs=v(this.value,s=>this.valueKind.mode==="consumes"?[{kind:this.valueKind.kind,name:s}]:[])}reset(){const e=l(this.value);he.isEqual(e,"")||this.value.set("")}async toManifestString(){return`${this.valueKind.kind}("${l(this.value)}")`}isEmbeddable(){return!0}initializeFromProgrammaticValue(e,n){if(e.kind==="Bucket"?this.value.set(n.idForExistingOwnable("Bucket",e.value)):e.kind==="Proof"&&this.value.set(n.idForExistingOwnable("Proof",e.value)),e.kind==="AddressReservation"&&this.value.set(n.idForExistingOwnable("AddressReservation",e.value)),e.kind==="Address"){const s=e.value;if(s.kind!=="Named")throw new Error("Expected a named address");this.value.set(n.idForExistingOwnable("NamedAddress",s.value))}}initializeFromPersistentValue(e){this.value.set(e.value)}toPersistableValue(){return{kind:this.valueKind.kind,value:l(this.value)}}}class ls extends w{constructor(e,n){super(e,f(""),n);d(this,"validationResult");this.validationResult=v(this.value,async s=>{const i=["ENTIRE_WORKTOP","ENTIRE_AUTH_ZONE"];return i.includes(s)?A.ok():A.error({message:"Value must be one of "+i.join(", "),context:"ValueNode"})})}reset(){this.value.set("")}async toManifestString(){return`Expression("${l(this.value)}")`}isEmbeddable(){return!0}initializeFromProgrammaticValue(e,n){this.value.set(e.value)}initializeFromPersistentValue(e){this.value.set(e.value)}toPersistableValue(){return{kind:"Expression",value:l(this.value)}}}class J extends w{constructor(e,n){super(e,f(J.createEmptyValueForType(e.kind)),n);d(this,"allowedActualKinds");d(this,"validationResult");this.allowedActualKinds=e.kind==="Bytes"?["Bytes","Blob"]:["Blob"],this.validationResult=v(this.value,async s=>{var r;const i=this.valueKind.kind==="Bytes"?this.valueKind.length:void 0;return s.kind==="Bytes"?this.validateBytesValue(s.dataHex,i):s.kind==="Blob"?this.validateBlobValue((r=s.data)==null?void 0:r.data,i):A.error({message:"File missing",context:"ValueNode"})})}validateBytesValue(e,n){return e?n!==void 0&&e.length!==n*2?A.error({message:`Invalid length: expected ${n} bytes resp. ${n*2} hex digits but found ${e.length} hex digits`,context:"ValueNode"}):Nt.test(e)?A.ok():A.error({message:"Invalid bytes hex string",context:"ValueNode"}):A.error({message:"Value missing",context:"ValueNode"})}validateBlobValue(e,n){return e==null?A.error({message:"Value missing",context:"ValueNode"}):n!==void 0&&e.length!==n?A.error({message:`Invalid length: expected ${n} bytes but found ${e.length}`,context:"ValueNode"}):A.ok()}reset(){this.reinitializeValueForType("Bytes")}reinitializeValueForType(e){this.value.set(J.createEmptyValueForType(e))}static createEmptyValueForType(e){return e==="Bytes"?{kind:"Bytes",dataHex:""}:{kind:"Blob",data:void 0}}async toManifestString(){var n;const e=l(this.value);return e.kind==="Bytes"?`Bytes("${e.dataHex}")`:e.kind==="Blob"?`Blob("${((n=e.data)==null?void 0:n.dataHash)??""}")`:`Blob("${e.dataHash}")`}isEmbeddable(){return!1}initializeFromProgrammaticValue(e,n){if(e.kind==="Blob")this.value.set({kind:"ImportedBlob",dataHash:bt(e.value)});else{const s=e.elements.map(i=>{if(i.kind!==z.U8)throw new Error("Invalid case");return i.value.toString(16).padStart(2,"0")}).join("");this.value.set({kind:"Bytes",dataHex:s})}}initializeFromPersistentValue(e){this.value.set(e.value)}toPersistableValue(){var s;const e=l(this.value);let n;switch(e.kind){case"Bytes":n=e;break;case"Blob":n={kind:"ImportedBlob",dataHash:(s=e.data)==null?void 0:s.dataHash};break;case"ImportedBlob":n=e}return{kind:this.valueKind.kind,value:n}}}class De extends w{constructor(e,n){super(e,f(""),n);d(this,"validationResult");this.validationResult=v(this.value,async s=>s?(this.valueKind.kind==="Decimal"?pt:kt).validate(s):A.error({message:"Value missing",context:"ValueNode"}))}reset(){this.value.set("")}async toManifestString(){return`${this.valueKind.kind}("${l(this.value)}")`}isEmbeddable(){return!0}initializeFromProgrammaticValue(e){this.initializeFromDecimal(e.value)}initializeFromDecimal(e){this.value.set(Pt(e))}initializeFromPersistentValue(e){this.value.set(e.value)}toPersistableValue(){return{kind:this.valueKind.kind,value:l(this.value)}}}class Oe extends w{constructor(e,n){super(e,Oe.createValue(n),n);d(this,"validationResult");this.value.address.value.subscribe(async s=>{const i=l(this.value.address.value),r=await re.useEntity(i);if(r){const o=r.details,u=l(this.value.nonFungibleLocalId.value);u.variant=o.nonFungibleIdType,this.value.nonFungibleLocalId.value.set(u),this.value.nonFungibleIdVariantSelectable.set(!1)}else this.value.nonFungibleIdVariantSelectable.set(!0)}),this.validationResult=v([this.value.address.validationResult,this.value.nonFungibleLocalId.validationResult],async([s,i])=>new A([...(await s).errors,...(await i).errors]))}reset(){this.value.nonFungibleLocalId.reset(),this.value.address.reset(),this.value.nonFungibleIdVariantSelectable.set(!0)}static createValue(e){const n=l(y({kind:"Address",variants:["NonFungibleResource"]},e).valueNode),s=l(y({kind:"NonFungibleLocalId"},e).valueNode);return{address:n,nonFungibleLocalId:s,nonFungibleIdVariantSelectable:f(!0)}}async toManifestString(){const e=l(this.value.address.value),n=$.mapNonFungibleLocalIdToString(l(this.value.nonFungibleLocalId.value));return`NonFungibleGlobalId("${e}:${n}")`}initializeFromProgrammaticValue(e,n){const s=e.fields[0],i=e.fields[1];if(s.kind!=="Address"||i.kind!=="NonFungibleLocalId")throw new Error("Invalid value kinds");this.value.address.initializeFromProgrammaticValue(s,n),this.value.nonFungibleLocalId.initializeFromProgrammaticValue(i,n)}initializeFromPersistentValue(e){this.value.address.initializeFromPersistentValue(e.addressValue),this.value.nonFungibleLocalId.initializeFromPersistentValue(e.nonFungibleLocalIdValue)}toPersistableValue(){return{kind:"NonFungibleGlobalId",addressValue:this.value.address.toPersistableValue(),nonFungibleLocalIdValue:this.value.nonFungibleLocalId.toPersistableValue()}}}class us{constructor(t){d(this,"fixedValueNode");d(this,"valueKind");d(this,"valueNode");d(this,"validationResult");d(this,"consumedInputs");this.fixedValueNode=t,this.valueKind=H(t.valueKind),this.valueNode=H(t),this.validationResult=t.validationResult,this.consumedInputs=t.consumedInputs}currentValueNode(){return this.fixedValueNode}toManifestString(){return l(this.valueNode).toManifestString()}getChildValueNodes(){return l(this.valueNode).getChildValueNodes()}toPersistableValue(){return l(this.valueNode).toPersistableValue()}initializeFromProgrammaticValue(t,e){l(this.valueNode).initializeFromProgrammaticValue(t,e)}initializeFromPersistentValue(t){l(this.valueNode).initializeFromPersistentValue(t)}isEmbeddable(){return l(this.valueNode).isEmbeddable()}}class ds{constructor(t,e){d(this,"valueKind");d(this,"valueNode");d(this,"validationResult");d(this,"consumedInputs");this.instructionNode=t,this.valueKind=f(e),this.valueNode=f(this.deriveValueNodeFromValueKind(e,t)),this.validationResult=Ke(this.valueNode,n=>n.validationResult),this.consumedInputs=Ke(this.valueNode,n=>n.consumedInputs??H([]))}deriveValueNodeFromValueKind(t,e){return j(t,"consumes").kind!=="Any"?qe(t,e):new je(e)}setValueKind(t){V(this.valueKind).set(t),V(this.valueNode).set(this.deriveValueNodeFromValueKind(t,this.instructionNode))}currentValueNode(){return l(this.valueNode)}toManifestString(){return l(this.valueNode).toManifestString()}getChildValueNodes(){return l(this.valueNode).getChildValueNodes()}toPersistableValue(){return l(this.valueNode).toPersistableValue()}initializeFromProgrammaticValue(t,e){l(this.valueNode).initializeFromProgrammaticValue(t,e)}initializeFromPersistentValue(t){l(this.valueNode).initializeFromPersistentValue(t)}isEmbeddable(){return!1}}class cs{constructor(t){d(this,"command",f(void 0));d(this,"enabled",f(!0));d(this,"fixedArgs",f([]));d(this,"variableArgs",f(Promise.resolve(void 0)));d(this,"manuallyAddedArgs",f([]));d(this,"args",v([this.fixedArgs,this.variableArgs,this.manuallyAddedArgs],async([t,e,n])=>{const s=await e;return s!==void 0?[...t,...s]:[...t,...n]}));d(this,"inputs",f([]));d(this,"outputs",f([]));d(this,"upstreamOutputsUnsubscriber");d(this,"consumableFilter");d(this,"instructionAdvisor");d(this,"variableArgDefinitionsProviderUnsubscriber");d(this,"id");d(this,"previousVariableArgDefs");d(this,"previousVariableArgs");d(this,"unsubscribes",[]);d(this,"validationResult");d(this,"argConsumedInputs");this.manifestNode=t,this.id=fe();const e=v([this.variableArgs,this.manuallyAddedArgs],async([i,r])=>{const o=await i;return o??r});this.argConsumedInputs=ve(v(ne(We(e,[]),i=>q(i.map(r=>r.value.consumedInputs))),Z.flatten)),this.unsubscribes.push(this.command.subscribe(i=>{var u,c;if(!i)return;const o=g.lookupInstructionDefinition(i).args.map(m=>this.createInstructionArgument(m));this.fixedArgs.set(o),this.variableArgs.set(Promise.resolve(void 0)),(u=this.instructionAdvisor)==null||u.unsubscribe(),(c=this.variableArgDefinitionsProviderUnsubscriber)==null||c.call(this)})),this.unsubscribes.push(v([this.command,this.fixedArgs],W).subscribe(([i,r])=>{var m;if((m=this.variableArgDefinitionsProviderUnsubscriber)==null||m.call(this),!i)return;const u=g.lookupInstructionDefinition(i).variableArgDefinitionsProvider,c=u?new u().getVariableArgDefinitions(this):void 0;this.variableArgDefinitionsProviderUnsubscriber=c==null?void 0:c.subscribe(h=>{const b=h.then(N=>{if(Z.isEqual(N,this.previousVariableArgDefs))return this.previousVariableArgs;{this.previousVariableArgDefs=N;const p=N==null?void 0:N.map(P=>this.createInstructionArgument(P));return this.previousVariableArgs=p,p}});this.variableArgs.set(b)})}));let n;this.unsubscribes.push(v([this.command,this.enabled],W).subscribe(async([i,r])=>{var c,m,h;(c=this.consumableFilter)==null||c.unsubscribe(),(m=this.instructionAdvisor)==null||m.unsubscribe(),(h=this.variableArgDefinitionsProviderUnsubscriber)==null||h.call(this);const o=`${i}-${r}`;if(o===n)return;n=o;let u;if(i&&r){const b=g.lookupInstructionDefinition(i),N=b.consumableFilter;u=N?new N:new Le;const p=b.instructionAdvisor,P=p?new p:void 0;P==null||P.subscribe(this),this.instructionAdvisor=P}else u=new Le;u==null||u.subscribe(this.inputs,this.outputs,this),this.consumableFilter=u}));const s=Ft(this.args,i=>i.map(r=>r.value.validationResult));this.validationResult=v([this.command,s],async([i,r])=>i?r:A.error({message:"Instruction command missing",context:"InstructionNode"}))}addArgument(t){const n=`arg #${l(this.manuallyAddedArgs).length}`,s={value:y(t,this,!0),name:n};return this.manuallyAddedArgs.update(i=>(i.push(s),i)),s}removeArgumentAt(t){this.manuallyAddedArgs.update(e=>(e.splice(t,1),e))}createInstructionArgument(t){return{value:y(t.valueKind,this),name:t.name}}async toManifestString(){const t=l(this.command),e=await l(this.args),n=(await Promise.all(e.map(async i=>{const r=await i.value.toManifestString();return`
${ie(r,ae)}`}))).join(""),s=e.length===0?";":`
;`;return t+n+s}async getAllValueNodes(){const e=(await l(this.args)).map(s=>l(s.value.valueNode)),n=e.flatMap(s=>s.getChildValueNodes());return[...e,...n]}setUpstreamOutputs(t){var e;(e=this.upstreamOutputsUnsubscriber)==null||e.call(this),this.upstreamOutputsUnsubscriber=t.subscribe(n=>{const s=l(this.inputs);he.isEqual(n,s)||this.inputs.set(n)})}unsubscribeAll(){var t,e,n,s;this.unsubscribes.forEach(i=>i()),(t=this.upstreamOutputsUnsubscriber)==null||t.call(this),(e=this.variableArgDefinitionsProviderUnsubscriber)==null||e.call(this),(n=this.instructionAdvisor)==null||n.unsubscribe(),(s=this.consumableFilter)==null||s.unsubscribe()}async toPersistableInstruction(){const t=(await l(this.args)).map(e=>({value:e.value.toPersistableValue(),name:e.name}));return{command:l(this.command),enabled:l(this.enabled),args:t}}}function Ee(a,t="consumes"){if(a!==void 0)return a.kind==="LocalSchemaReference"?a.localSchemaReference.resolveToValueKind():a.kind==="WellKnownReference"?It(a.name,t):a}const ms={Any:je,Bool:Jt,I8:R,I16:R,I32:R,I64:R,I128:R,U8:R,U16:R,U32:R,U64:R,U128:R,String:qt,Tuple:B,Enum:B,Array:B,Map:B,Address:os,NamedAddress:ce,AddressReservation:ce,Bucket:ce,Proof:ce,Expression:ls,Blob:J,Decimal:De,PreciseDecimal:De,NonFungibleLocalId:$,NonFungibleGlobalId:Oe,Bytes:J,LocalSchemaReference:void 0,WellKnownReference:void 0};function y(a,t,e=!1){let n=j(a,"consumes");return n.kind!="Any"&&!e?new us(qe(n,t)):new ds(t,n)}function qe(a,t){if(a==null||a.kind==="Any")throw new Error(`Function createNewValueNode cannot be called with valueKind null or Any: ${a}`);let e=j(a,"consumes");const n=ms[e.kind];if(n==null)throw new Error("No constructor found for value kind: "+e.kind);return Reflect.construct(n,[e,t])}class we{constructor(t=fe()){d(this,"id");d(this,"label");d(this,"transactionMessage",f(""));d(this,"instructions",f([]));d(this,"enabledInstructions",gs(this.instructions));d(this,"danglingOutputs",ve(v(this.instructions,(t,e)=>{const n=t[t.length-1];if(!n){e([]);return}return n.outputs.subscribe(s=>{const i=s.filter(r=>(r.kind==="Bucket"||r.kind==="AddressReservation")&&!r.isConsumed).map(r=>({kind:r.kind,name:r.name}));e(i)})},[])));d(this,"validationResultWithoutStaticValidation",se(this.enabledInstructions,t=>t.map(e=>e.validationResult)));d(this,"validationResult",Et(this.validationResultWithoutStaticValidation,1e3,async t=>{if(!(await t).valid)return t;const e=await this.toManifestString(),n=await Vt(e);if(n.valid)return A.ok();{const i=n.errors[0].message.replaceAll(/Radix Engine Toolkit error for invocation .* response is/g,"");let r=JSON.parse(i);for(;r.error!=null;)r=r.error;return A.error({message:r.toString(),context:"ManifestNode"})}}));this.id=t,this.label=f("")}async toManifestString(){let t=l(this.instructions);return(await Promise.all(t.filter(e=>l(e.enabled)).filter(e=>l(e.command)).map(e=>e.toManifestString()))).join(`

`)}async getBlobs(){return(await this.getAllValueNodes()).flatMap(e=>{if(e instanceof J){const n=l(e.value);if(n.kind==="Blob"&&n.data!=null)return[n.data.getDataHex()]}return[]})}insertNewInstruction(t){const e=l(this.instructions),n=e[t-1],s=e[t],i=new cs(this);return i.setUpstreamOutputs((n==null?void 0:n.outputs)??f([])),s&&s.setUpstreamOutputs(i.outputs),e.splice(t,0,i),this.instructions.set(e),i}removeInstructionAtIndex(t){const e=l(this.instructions),n=e[t],s=e[t-1],i=e[t+1];n.unsubscribeAll(),i&&i.setUpstreamOutputs((s==null?void 0:s.outputs)??f([])),e.splice(t,1),this.instructions.set(e)}async getAllValueNodes(){return(await Promise.all(l(this.instructions).map(t=>t.getAllValueNodes()))).flat()}async toPersistableManifest(){const t=await Promise.all(l(this.instructions).map(e=>e.toPersistableInstruction()));return{id:this.id,label:l(this.label),transactionMessage:l(this.transactionMessage),instructions:t}}isFactuallyEmpty(){return l(this.instructions).find(t=>l(t.command)!=null)==null}}function gs(a){return v(a,(t,e)=>{t.length===0&&e([]);const n=t.map(s=>s.enabled.subscribe(i=>{e(t.filter(r=>l(r.enabled)))}));return()=>n.forEach(s=>s())})}const pe=`${Rt}manifests`,vs=`${pe}:current`,hs=`${pe}:open`,fs=`${pe}:recently-closed`,As=1e3;class Ns{constructor(){d(this,"activeManifestId");d(this,"openManifestIds");d(this,"recentlyClosedManifests");d(this,"openManifests");d(this,"activeManifest");this.activeManifestId=Ot(vs,void 0),this.openManifestIds=xe(hs),this.recentlyClosedManifests=xe(fs);const t=l(this.activeManifestId),e=l(this.openManifestIds).flatMap(n=>{const s=U.loadManifestPairFromLocalStorage(n);if(!s)return console.error(`Manifest not found: ${n}`),[];const i=K.isDirty(s),r=s.savedVersion!=null,o=new U(n,s.currentVersion.label,i,r);if(n===t)try{return[o.load()]}catch(u){return Be(n,u),new Array}else return[o]});this.openManifests=f(e),this.activeManifest=v(this.openManifests,n=>n.find(s=>s instanceof K))}activateManifest(t){try{const e=l(this.openManifests).map(n=>n instanceof K?n.unload():n.id===t?n.load():n);V(this.openManifests).set(e),V(this.activeManifestId).set(t)}catch(e){console.error(`An unexpected error occurred while loading persistent manifest ${t}:`,e),Ge({message:"Could not load manifest",type:"Error"})}}addManifestAndActivate(t,e,n){const s=l(this.openManifests).map(o=>o instanceof K?o.unload():o),i=new K(e,n,t,!1,!1),r=[...s,i];V(this.openManifests).set(r),this.openManifestIds.set(r.map(o=>o.id)),V(this.activeManifestId).set(e)}async createNewManifestAndActivate(t=!1){let e=new we;t&&e.insertNewInstruction(0),this.addManifestAndActivate(Promise.resolve(e),e.id,l(e.label))}async importManifestAndActivate(t,e=""){const[n,s]=Xt(t,e);try{await s,this.addManifestAndActivate(s,n,e)}catch(i){Be(n,i)}}openRecentlyClosedManifest(t){const e=[...l(this.openManifests),new U(t.id,t.label,!1,!0)];V(this.openManifests).set(e),this.openManifestIds.set(e.map(n=>n.id)),this.activateManifest(t.id),this.recentlyClosedManifests.update(n=>n.filter(s=>s.id!==t.id))}async closeManifest(t,e){let n=l(this.openManifests);const s=t===l(this.activeManifestId),i=n.findIndex(u=>u.id===t);if(n.splice(i,1),s){const u=Math.max(i-1,0),c=n.length-1,m=Math.min(u,c),h=m>=0?n[m]:void 0;if(h)try{n[m]=h.load(),V(this.activeManifestId).set(void 0)}catch{V(this.activeManifestId).set(void 0)}else V(this.activeManifestId).set(void 0)}V(this.openManifests).set(n),this.openManifestIds.set(n.map(u=>u.id));const r=te(t),o=U.loadManifestPairFromLocalStorage(t);e==="save"?(o.savedVersion=o.currentVersion,localStorage.setItem(r,JSON.stringify(o)),this.recentlyClosedManifests.push({id:t,label:o.currentVersion.label})):o.savedVersion!=null?(o.currentVersion=o.savedVersion,localStorage.setItem(r,JSON.stringify(o)),this.recentlyClosedManifests.push({id:t,label:o.currentVersion.label})):localStorage.removeItem(r)}deleteRecentlyClosedManifest(t){if(new Set(l(this.openManifestIds)).has(t))throw new Error("Cannot delete currently open manifest");const n=te(t);localStorage.removeItem(n),this.recentlyClosedManifests.update(s=>s.filter(i=>i.id!==t))}}class K{constructor(t,e,n,s,i){d(this,"persistCurrentUnsubscriber");d(this,"labelSynchronizerUnsubscriber");d(this,"scheduledPersistLatestTimerId");d(this,"label");d(this,"isDirty");d(this,"hasSavedVersion");this.id=t,this.promisedManifestNode=n,this.label=f(e),this.isDirty=f(s),this.hasSavedVersion=f(i),n.then(r=>{this.persistCurrentUnsubscriber=v([r.validationResult,r.label,r.transactionMessage],W).subscribe(async o=>{this.scheduledPersistLatestTimerId&&clearTimeout(this.scheduledPersistLatestTimerId),this.scheduledPersistLatestTimerId=setTimeout(async()=>{const u=await K.persistLatestVersion(r);V(this.isDirty).set(u)},As)}),this.labelSynchronizerUnsubscriber=r.label.subscribe(o=>{V(this.label).set(o)})})}async save(){this.scheduledPersistLatestTimerId&&(clearTimeout(this.scheduledPersistLatestTimerId),this.scheduledPersistLatestTimerId=void 0);const t=await this.promisedManifestNode,e=await t.toPersistableManifest(),n=te(t.id),s={id:t.id,currentVersion:e,savedVersion:e};localStorage.setItem(n,JSON.stringify(s)),V(this.isDirty).set(!1)}static async persistLatestVersion(t){const e=await t.toPersistableManifest(),n=te(t.id),s=localStorage.getItem(n);if(s!=null){const i=JSON.parse(s);return i.currentVersion=e,localStorage.setItem(n,JSON.stringify(i)),this.isDirty(i)}else{const i={id:t.id,currentVersion:e};return localStorage.setItem(n,JSON.stringify(i)),!0}}static isDirty(t){return JSON.stringify(t.currentVersion)!==JSON.stringify(t.savedVersion)}unload(){var t,e;return(t=this.persistCurrentUnsubscriber)==null||t.call(this),(e=this.labelSynchronizerUnsubscriber)==null||e.call(this),new U(this.id,l(this.label),l(this.isDirty),l(this.hasSavedVersion))}}class U{constructor(t,e,n,s){d(this,"label");d(this,"isDirty");d(this,"hasSavedVersion");this.id=t,this.label=H(e),this.isDirty=H(n),this.hasSavedVersion=H(s)}load(){const t=U.loadManifestPairFromLocalStorage(this.id),e=t.currentVersion.label,n=bs(t.currentVersion),s=K.isDirty(t),i=t.savedVersion!=null;return new K(this.id,e,n,s,i)}static loadManifestPairFromLocalStorage(t){const e=te(t),n=localStorage.getItem(e);return JSON.parse(n)}}function te(a){return`${pe}:${a}`}async function bs(a){const t=new we(a.id);t.label.set(a.label),t.transactionMessage.set(a.transactionMessage);for(let e=0;e<a.instructions.length;e++){const n=a.instructions[e],s=t.insertNewInstruction(e);s.command.set(n.command),s.enabled.set(n.enabled),await ps(n,s)}return t}async function ps(a,t){const e=a.args;await new Promise(r=>setTimeout(r,1));let n=0;for(const r of l(t.fixedArgs)){const o=e[n];r.value.initializeFromPersistentValue(o.value),n++}const s=e.slice(n),i=await l(t.variableArgs)??[];for(let r=0;r<s.length;r++){const o=s[r];(i[r]??t.addArgument(ee(o.value.kind,"consumes"))).value.initializeFromPersistentValue(o.value)}}function Be(a,t){Ge({message:"Could not load manifest",type:"Error"}),console.error(`Failed to load persistent manifest ${a}:`,t)}const Ts=new Ns;export{ns as A,rs as E,Is as F,is as M,$ as N,ss as O,as as T,ds as V,Ms as a,us as b,y as c,g as i,Ts as m};
